name: Publish Packages
on:
  workflow_call:
    inputs:
      KEY:
        required: true
        type: string
      REF_NAME:
        required: true
        type: string
    secrets:
      NPMJS_TOKEN:
        required: true

jobs:
  initialize:
    name: Initialize CI environment
    uses: yaml-js/.github/.github/workflows/jobs.initialize-ci@main
    with:
      KEY: ${{Â inputs.KEY }}

  publish:
    needs: [initialize]
    name: Publish Packages
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
    - name: Enable Corepack
      run: corepack enable
    - name: Checkout
      uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 22.x
    - uses: actions/cache/restore@v4
      id: restore-cache-build
      with:
        path: ./*
        key: ${{ inputs.KEY }}-build
    - name: Bump Version of package.json
      uses: ramonpaolo/bump-version@v2.3.1
      with:
        tag: ${{ inputs.REF_NAME }}
        commit: false
        path: ./packages/vite-plugin/package.json
    - name: Publish Packages
      run: yarn deploy
      env:
        NPMJS_TOKEN: ${{ secrets.NPMJS_TOKEN }}
